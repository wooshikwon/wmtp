# M3 Test Recipe - MTP Baseline Algorithm
# Simple uniform weighting for Multi-Token Prediction

# Run metadata
run:
  name: "m3_test_mtp_baseline"
  tags:
    - "test"
    - "m3"
    - "baseline"
    - "mtp"

# Phase 2: Model configuration 제거됨
# - 모델 경로는 config.mtp_baseline.yaml에서 관리
# - MTP 설정은 고정값 사용 (n_heads=4, horizon=4)
# - 토크나이저는 환경 기반 자동 선택

# Training configuration
train:
  algo: "baseline-mtp"  # Uniform weighting
  full_finetune: true
  max_steps: 2
  # checkpointing moved to config.paths.checkpoints in Phase 2

# Optimizer configuration
optim:
  optimizer: "adamw"
  lr: 5.0e-5
  weight_decay: 0.01
  betas: [0.9, 0.999]
  grad_clip: 1.0
  scheduler: "constant"
  warmup_ratio: 0.0

# Data configuration
data:
  train:
    sources: ["mbpp"]
    max_length: 128
    batch_size: 1
    pack_sequences: false
  eval:
    sources: ["mbpp"]
    max_length: 128
    batch_size: 1
    pack_sequences: false

# Loss configuration - baseline (uniform weights)
loss:
  weight_norm: "none"
  lambda: 0.001
  weight_temperature: 1.0
  epsilon: 1.0e-8
  max_weight: 1.01

# Evaluation configuration
eval:
  protocol: "meta-mtp"
  sampling:
    temperature: 0.7
    top_p: 0.9
    n: 1
  metrics:
    - "mbpp_exact"
